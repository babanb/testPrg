@using Resources = ADOPets.Web.Resources.Wording;
@using ADOPets.Web.Common.Extensions
@using ADOPets.Web.Common.Helpers
@using Model
@model ADOPets.Web.ViewModels.SMO.DetailsViewModel
@{
    ViewBag.Title = Resources.Smo_Edit_Title;
    int userId = ViewBag.UserId;
    bool flagResponse = false;
    foreach (var item in Model.SMOExpertsList)
    {
        if (item.VetExpertID == userId && item.ExpertResponse != null)
        {
            flagResponse = true;
        }
    }
}

@Html.HiddenFor(model => model.SMOREquest.ID, new { id = "SMOId" })
@Html.Hidden("ExpertCommitteeURL", Url.Action("ExpertCommittee", "SMO"))
@Html.Hidden("UrlForSendMessage", Url.Action("SendMessage", "SMO"))
<div class="clearfix"></div>

<div id="pageTitle">
    <div class="row">
        <div class="col-md-8">
            <h1>@Resources.Smo_Edit_SMOID - @(Html.DisplayFor(a => a.SMOId))<span class="label label-primary">@Model.SMOREquest.SMORequestStatusId</span></h1>
        </div>
        <div class="col-md-4"><a href="@Url.Action("Index", "SMO")" class="btn btn-primary pull-right"><i class="fa fa-angle-left"></i>@Resources.Smo_Edit_BackButton</a> </div>
    </div>
</div>
<div id="mainContainer">
    @if (!Roles.IsUserInRole(UserTypeEnum.VeterinarianAdo.ToString()) && !Roles.IsUserInRole(UserTypeEnum.VeterinarianLight.ToString()) && !Roles.IsUserInRole(UserTypeEnum.VeterinarianExpert.ToString()))
    {
        <div id="hiderightsidebar">
            <img src="@Url.Content("~/Content/images/hide-img.png")" width="22" height="34" alt=""/>
        </div>
        <div id="showrightsidebar">
            <img src="@Url.Content("~/Content/images/show-img.png")" width="22" height="34" alt=""/>
        </div>
    }
    @if (Roles.IsUserInRole(UserTypeEnum.Admin.ToString()) || Roles.IsUserInRole(UserTypeEnum.VeterinarianAdo.ToString()) || Roles.IsUserInRole(UserTypeEnum.VeterinarianLight.ToString()))
    {
        <div id="cover4econsult" style="background:@Url.Content("~/images/smo-cover.jpg") center left repeat; ">
            <div class="consultSteptab radius3">
                <a href="@Url.Action("Edit", "SMO", new { id = Model.SMOREquest.ID })" class="zoomin">@Resources.Smo_Edit_lblStep1<br>
                    <span>@Resources.Smo_Edit_SMODetails</span><i class="fa fa-arrow-right"></i></a>
            </div>
            <div class="consultSteptab radius3 active">
                <a href="@Url.Action("AssignedExperts", "SMO", new { id = Model.SMOREquest.ID })" class="zoomin">@Resources.Smo_Edit_lblStep2<br>
                    <span>@if (@Model.SMOREquest.SMORequestStatusId != SMORequestStatusEnum.Complete)
                          { 
                        @Resources.Smo_Edit_Experts
                          }
                          else
                          {
                        @Resources.Smo_Edit_ExpertsDetails
                          }</span><i class="fa fa-arrow-right"></i></a>

            </div>
            <div class="consultSteptab radius3">
                @if (@Model.SMOREquest.SMORequestStatusId != SMORequestStatusEnum.Complete)
                { 
                    <a href="@Url.Action("SubmitReport", "SMO", new { id = @Model.SMOREquest.ID })" class="zoomin">@Resources.Smo_Edit_lblStep3<br>
                        <span>@Resources.Smo_Edit_SubmitReport</span></a> 
                }
                else
                {
                    <a href="@Url.Action("ViewReport", "SMO", new { id = @Model.SMOREquest.ID })" class="zoomin">@Resources.Smo_Edit_lblStep3<br>
                        <span>@Resources.Smo_Edit_ViewReport</span></a>
                }

            </div>
            <div class="clearfix"></div>
        </div>
    }
    else
    {
        <div id="cover4econsult" style="background:@Url.Content("~/images/smo-cover.jpg") center left repeat; padding:2% 20%;">
            <div class="consultSteptab radius3 active" style="width: 40%;">
                <a href="@Url.Action("Edit", "SMO", new { id = Model.SMOREquest.ID })" class="zoomin">@Resources.Smo_Edit_lblStep1<br>
                    <span>@Resources.Smo_Edit_SMODetails</span><i class="fa fa-arrow-right"></i></a>
            </div>
            <div class="consultSteptab radius3 " style="width: 40%;">
                @if (flagResponse)
                {
                    <a href="@Url.Action("ShowVetExpertResponse", "SMO", new { id = Model.SMOREquest.ID })" class="zoomin">@Resources.Smo_Edit_lblStep2<br>
                        <span>@Resources.Smo_Edit_ViewResponse
                        </span><i class="fa fa-arrow-right"></i></a> 
                }
                else
                {
                    <a href="@Url.Action("VetExpertResponse", "SMO", new { id = Model.SMOREquest.ID })" class="zoomin">@Resources.Smo_Edit_lblStep2<br>
                        <span>@Resources.Smo_Edit_GiveResponse
                        </span><i class="fa fa-arrow-right"></i></a> 
                }
            </div>
            <div class="clearfix"></div>
        </div>
    }
    <div style="padding-bottom: 10px;" class="pull-right">
        <div class="pull-left">@Resources.Smo_Edit_lblShowmessagesfrom</div>
        <div class="pull-left" style="margin: -6px 10px 10px 10px">

            @Html.DropDownList("Expert", ViewBag.ExpertCommittee as IEnumerable<SelectListItem>, Resources.Smo_Edit_lblAll, new { @id = "ExpertCommittee", @class = "form-control" })
        </div>
        <a href="@Url.Action("VetExpertAdo", "SMO", new { id = Model.SMOREquest.ID })" class="btn btn-primary btn-sm pull-right" style="margin: -6px 0 10px 0"><i class="fa fa-angle-left"></i>@Resources.Smo_Edit_BackButton</a>
    </div>
    <div class="clearfix"></div>
    @* <div id="dvHdnTotalRecords" style="display: none;">
            @Model.ExpertCommittees.Count().ToString()
        </div>*@ <div id="subCntnt1"></div>
    <div id="listing-main" data-container="paging_container" data-page-size="10">
        @foreach (var a in Model.ExpertCommittees)
        {
            <div class="listingExpert" data-sub-container="sub_container">
                <div data-item="item">
                    <div class="gray-bar">
                        @{
            var expertDate = TimeZoneHelper.ConvertDateTimeByUserTimeZoneId(Convert.ToDateTime(a.Date));   
                        }
                        <div class="pull-left"><strong>@Resources.Smo_Edit_From:<span id="spnFirstName" data-item-name="first_name"> @a.User.FirstName.Value @Html.Raw(" ")  @a.User.LastName.Value </span></strong>| <span>@expertDate.ToString("hh:mm tt dd MMM,yyyy") </span></div>
                        <div class="pull-right pull-right-m">
                            <a onclick="deleteMessage(@a.Id,@a.SMORequestId)" href="#" 
                                data-href="@Url.Action("DeleteMessage", "SMO")" id="lnkDeleteMessage" class="text-danger">
                                <i class="fa fa-trash-o"></i>@Resources.Smo_Edit_DeleteButton</a>
                        </div>
                        <div class="clearfix"></div>
                    </div>
                    <p style="padding-top: 15px; line-height: 22px;">@a.Message</p>
                </div>
            </div>
            <hr>   
        }
    </div>
    <div id="pagingControls" data-paging-control="paging_control"></div>

    @Html.TextArea("ExpertMessage", string.Empty, new { placeholder = Resources.Smo_Edit_EnterYourMessageHerePlaceHolder, @class = "form-control" })
    <br>
    <a href="#" id="btnSendMessage" class="btn btn-success"><i class="fa fa-paper-plane-o"></i>@Resources.Smo_Edit_SendMessageButton</a> <a href="@Url.Action("VetExpertAdo", "SMO", new { id = Model.SMOREquest.ID })" class="btn btn-warning">@Resources.Smo_Edit_CancelButton</a>
    <div class="clearfix"></div>
</div>
<div class="clearfix"></div>

<script src="@Url.Content("~/Scripts/external/pagination.js")"></script>
<script src="@Url.Content("~/Scripts/customs/views/SMO/ExpertCommittee.js")"></script>
<script>
    var resourceMessage = '@Html.Raw(Resources.Smo_Edit_PagedListPagerPageItemSliceAndTotalFormat)';
    var pager = new Pager();
    $(document).ready(function () {
        initPager(true);
    });
</script>


