var hdnIsFreeUser = false;
var finalval = 10;

$(document).ready(function () {
    var hdnIsFreeUser = $("#IsFreeUser").val();
    CalculatePrice();

    //$("#UserPlanInfo").removeClass("in").removeClass("active");
    //$("#UpgradeMyPlan").addClass("in").addClass("active");

    $("#AdditionalPets option").filter(function (index) { return $(this).val() === '0'; }).html($('#changeselectText').val()).val(0);
    $("#Promocode").val($("#CurrentPromocode").val());
    $("#AdditionalPets").change(function () {
        getRenwalPetsPrice();
    });
    $("#PlanName").change(function () {
        ChangePlan();
    });

    $("#Promocode").change(function () {
        ChangePlanListByPromoCode();
    });

    $('#CancelOwnerUpgradeplan').click(function () {
        $('#UpgradeMyPlan').removeClass('tab-pane fade in active').addClass('tab-pane fade');
        $('#UserPlanInfo').removeClass('tab-pane fade').addClass('tab-pane fade in active');

    });
});

function ChangePlan() {
    var petCount = $('#AdditionalPets').val();

    var Planid = $('#PlanName :selected').val();
    if (petCount == '') {
        petCount = 0;
    }

    $.getJSON(GetApplicationPath() + "Profile/GetPlanPrice", { PlanID: Planid, AdditionalPets: petCount },
        function (data) {
            $("#UpgradePlan").html(data.finalPlan);
            $("#UpgradePrice").html($("meta[name='accept-currency']").attr("content") + data.price);
            $("#AdditionalInfo").text(data.AdditionalInfo);
            $("#BasePlanDescription").text(data.Description);

            //  if (data.planvalue == 1) {
            $("#AdditionalPets").removeAttr('readonly');
            $("#AdditionalPets").removeAttr('disabled');
            //  } else
            if (data.planvalue == 2) {
                $("#AdditionalPets").attr('readonly', 'readonly');
                $("#AdditionalPets").attr('disabled', 'disabled');
            }

            $("#MaxPetCount").val(data.MaxPetCount);
            // if (data.planvalue == 1) {
            CalculatePrice();
            // }
            //  else { CalculatePrice(); }
        });

}

function ChangePlanListByPromoCode() {
    var promocode = $('#Promocode').val();
    var subItems;
    $.getJSON(GetApplicationPath() + "Users/GetPlansByPromocode", { promocode: promocode },
            function (data) {
                $.each(data.Items, function (index, item) {
                    subItems += "<option value='" + item.Value + "'>" + item.Text + "</option>";
                });
                //  $("#BasePlanId").val(data.Items[0].Value);
                $("#PlanName").html(subItems);
                $("#AdditionalInfo").text(data.AdditionalInfo);
                $("#BasePlanDescription").text(data.Description);
                ChangePlan();
            });
}

function getRenwalPetsPrice() {
    var AdditionalPets = $('#AdditionalPets :selected').val();
    AdditionalPets = AdditionalPets || 0;
    var selectedItem = parseInt($('#CurrentPlan_NumberofPets').val());
    selectedItem = selectedItem || 0;
    if (AdditionalPets < selectedItem) {
        $("#AdditionalPets").addClass("input-validation-error");
        $("#AddPetsErrMsg").css("display", "block");
        ChangePlan();
    } else {
        $("#AddPetsErrMsg").css("display", "none");
        $("#AdditionalPets").removeClass("input-validation-error");
        ChangePlan();
    }
}

function CalculatePrice() {
    var isPromo = $("#Promocode").val();
    var select1 = $("#MaxPetCount").val();
    var selectmultiple = 1, drpValue = 0;
    //alert("in calcprice::" + $("#MaxPetCount").val());

    $('#AdditionalPets').children('option:not(:first)').remove();
    var addpetDrp = document.getElementById("AdditionalPets");
    for (i = 0; finalval > drpValue; i++) {
        try {
            var o = document.createElement("option");
            o.value = selectmultiple;
            o.text = select1 * selectmultiple;
            drpValue = select1 * selectmultiple;
            if (!isPromo) {
                if (select1 >= (select1 * selectmultiple)) {
                    selectmultiple = selectmultiple + 1;
                    addpetDrp.appendChild(o);
                }
            }
            else {
                selectmultiple = selectmultiple + 1;
                addpetDrp.appendChild(o);
            }
        } catch (e) {
            break;
        }
    }

}