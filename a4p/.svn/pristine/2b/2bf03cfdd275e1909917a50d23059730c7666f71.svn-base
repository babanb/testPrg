@using Resources = ADOPets.Web.Resources.Wording
@using ADOPets.Web.Common.Extensions
@using ADOPets.Web.Common.Helpers

@model IEnumerable<ADOPets.Web.ViewModels.Econsultation.ExpertVeterinarainViewModel>
@{
    ViewBag.Title = Resources.Veterinarian_Index_Title;
}
<div id="dvHdnTotalRecords" style="display: none;">
    @*@Model.Count().ToString()*@
</div>
<div class="modal-dialog modal-lg">
    <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">@Resources.CloseButton</span></button>
            <h4 class="modal-title text-primary" id="myModalLabel">@Resources.Veterinarian_Index_Veterinarian</h4>
        </div>
        <div class="modal-body">
            <div class="well" id="vetsearch">
                <div class="row">
                    <div class="col-md-3">
                        <h4>@Resources.Veterinarian_Index_Search</h4>
                    </div>
                    <div class="col-md-4">
                        <label class="sr-only" for="VetNameFilter">@Resources.Veterinarian_Index_FirstNamePlaceHolder</label>
                        <input type="text" class="form-control" id="VetNameFilter" name="VetNameFilter" placeholder="@Resources.Veterinarian_Index_FirstNamePlaceHolder">
                    </div>
                    <div class="col-md-4">
                        <label class="sr-only" for="VetLastNameFilter">@Resources.Veterinarian_Index_LastNamePlaceHolder</label>
                        <input type="text" class="form-control" id="VetLastNameFilter" name="VetLastNameFilter" placeholder="@Resources.Veterinarian_Index_LastNamePlaceHolder">
                    </div>
                    <div class="col-md-1">
                        <button type="submit" class="btn btn-primary"><i class="fa fa-search" style="padding-right: 0;"></i></button>
                    </div>
                </div>
            </div>
            <div class="customscroll"> <div id="subCntnt1"></div>
                <div id="listing-main" data-container="paging_container" data-page-size="5">
                    @foreach (var item in Model)
                    {
                        <div class="listing3" data-sub-container="sub_container">
                            <div class="listing3Icon">
                                <img src="@Url.Action("GetImage", "Message", new { fromUserId = item.Id })" class="img-responsive" />
                            </div>
                            <div class="listing3content">
                                <div class="row" data-item="item">
                                    <div class="col-md-5">
                                        <p>
                                            <strong>@Resources.Veterinarian_Index_FirstName</strong> : <span id="spnVetName" data-item-name="spnVetName">@item.FirstName</span><br>
                                            <strong>@Resources.Veterinarian_Index_LastName</strong> : <span id="spnVetLName" data-item-type="spnVetLName">@item.LastName</span>
                                        </p>
                                    </div>
                                    <div class="col-md-6">
                                        <p>
                                            <strong>@Resources.Veterinarian_Index_Email</strong> : <span>@item.Email</span><br>
                                            <strong>@Resources.Veterinarian_Index_VetSpecialities</strong> : <span>@Html.EnumDisplay(item.VetSpeciality)</span><br>
                                        </p>
                                    </div>
                                    <div class="col-md-1">
                                        @Html.Hidden("VetID", item.Id)
                                        <a href="#" id="btn-sm1" class="btn btn-success btn-sm" onclick="callBtnClick1('@(item.Id)')" data-tooltip="tooltip" data-placement="top" title="" data-original-title="Select"><i id="selectVetAnchor" class="fa fa-square-o"></i></a>
                                    </div>
                                </div>
                            </div>
                            <div class="clearfix"></div>
                        </div>
                    }
                </div>
                <div id="pagingControls" data-paging-control="paging_control"></div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" id="vetclose-bt" class="btn btn-default" data-dismiss="modal">@Resources.Econsultation_Add_Close</button>
            <div class="clearfix"></div>
        </div>
    </div>
</div>
<script src="@Url.Content("~/Scripts/external/bootstrap-confirmation.js")"></script>
<script src="@Url.Content("~/Scripts/external/pagination.js")"></script>
@*<script src="@Url.Content("~/Scripts/customs/views/Econsultation/_SelectVet.js")"></script>*@

<script>
    var resourceMessage = '@Html.Raw(Resources.Pet_Index_PagedListPagerPageItemSliceAndTotalFormat)';
    var pager = new Pager();
    $(document).ready(function () {
        initPager(true);
    });

    function deleteConfirmation() {
        $('[data-toggle="confirmation"]').confirmation({
            title: '@Html.Raw(Resources.Pet_Index_StatusConfirmationTitle)',
            btnOkLabel: '@Html.Raw(Resources.Pet_Index_StatusConfirmationOkLabel)',
            btnCancelLabel: '@Html.Raw(Resources.Pet_Index_StatusConfirmationCancelLabel)'
        });
    }

    function callBtnClick1(id) {
        //debugger;
        var oItemId = id;
        var doctitle = $($(this).children("i[id=selectVetAnchor]"));
        var doc = $('.fa-check-square');
        doc.removeClass("fa-check-square").addClass("fa-square-o");
        doctitle.removeClass("fa-square-o").addClass("fa-check-square");
        
        $.ajax({
            url: '@Url.Action("SelectVet", "Econsultation")',
            data: { Id: oItemId },
            type: 'POST',
            dataType: 'json',
            success: function (Data) {
                console.log(Data);
                if (Data) {
                    $('#vetclose-bt').click();
                    $("#assignvetModal").text(Data.FirstName.Value + ' ' + Data.LastName.Value);
                    localStorage['selectedVet'] = $('#assignvetModal').text();

                    $("#assignvetModal").removeAttr('style');
                    $("#spnVetRequired").remove();                                      
                }
            },
            error: function (req, status, error) {

            }
        });        
    }

    //$("#VetNameFilter").on('keyup click', function () {
    //    $("#dvNoRecords").remove();
    //    filtertype = $("#VetNameFilter").val();        
    //    showAll();
    //    if (filtertype != "") {
    //        filtertype = filtertype.toLowerCase();
    //        displayRecordsSelectPetStartsWith(filtertype, 'VetLastNameFilter', 'listing3');
    //    }
    //    else {
            //$('div[class="listing3"]').removeAttr('style');
            //filtertype = $("#VetNameFilter").val();
            //if (filtertype == "" || filtertype == undefined) {
            //    showAll();
            //} else {
            //    filtertype = filtertype.toLowerCase();
            //    displayRecordsSelectPetStartsWith(filtertype, 'VetNameFilter', 'listing3');
            //    showPageFilter();
            //}
    //        $("[data-sub-container='sub_container']").removeAttr('style');
    //        var filtertype = $('#VetLastNameFilter').val();
    //        if (filtertype == "") { showAll(); } else {
    //            var filterPetType = $('#VetNameFilter').val();
    //            displayRecordsSelectPetStartsWith(filterPetType, 'VetNameFilter', 'listing3');
    //            showPageFilter();
    //        }
    //    }
    //});

    $("#VetNameFilter").on('keyup click', function () {
        $("#dvNoRecords").remove();
        filtertype = $("#VetNameFilter").val();
        showAll();
        if (filtertype != "") {
            filtertype = filtertype.toLowerCase();
            displayRecordsSelectPetStartsWith(filtertype, 'VetLastNameFilter', 'listing3');
        }
        else {
            $("[data-sub-container='sub_container']").removeAttr('style');
            var filtertype = $('#VetLastNameFilter').val();
            if (filtertype == "") { showAll(); } else {
                var filterPetType = $('#VetNameFilter').val();
                displayRecordsSelectPetStartsWith(filterPetType, 'VetNameFilter', 'listing3');
                showPageFilter();
            }
        }
    });

    //$("#VetLastNameFilter").on('keyup click', function () {
    //    filtertype = $("#VetLastNameFilter").val();
    //    showAll();
    //    if (filtertype != "") {
    //        filtertype = filtertype.toLowerCase();
    //        displayRecordsSelectPetStartsWith(filtertype, 'VetNameFilter', 'listing3');
    //    }
    //    else {
    //        $("[data-sub-container='sub_container']").removeAttr('style');
    //        var filtertype = $('#VetLastNameFilter').val();
    //        if (filtertype == "") { showAll(); } else {
    //            var filterPetType = $('#VetNameFilter').val();
    //            displayRecordsSelectPet(filterPetType, 'VetLastNameFilter', 'listing3');
    //            showPageFilter();
    //        }
    //    }
    //});

    $("#VetLastNameFilter").on('keyup click', function () {
        filtertype = $("#VetLastNameFilter").val();
        showAll();
        if (filtertype != "") {
            filtertype = filtertype.toLowerCase();
            displayRecordsSelectPetStartsWith(filtertype, 'VetNameFilter', 'listing3');
        }
        else {
            $("[data-sub-container='sub_container']").removeAttr('style');
            var filtertype = $('#VetLastNameFilter').val();
            if (filtertype == "") { showAll(); } else {
                var filterPetType = $('#VetNameFilter').val();
                displayRecordsSelectPetStartsWith(filterPetType, 'VetLastNameFilter', 'listing3');
                showPageFilter();
            }
        }
    });

    function displayRecordsSelectPetStartsWith(filtertype, petTypeFilter, subClass) {
        var petType = $('#' + petTypeFilter).val();
        
        var filterPetType = "";

        if (petType != undefined && petType != "") {
            filterPetType = $('#' + petTypeFilter).val();
        }

        filterPetType = filterPetType.toLowerCase();

        if (filterPetType == undefined || filterPetType == "") {
            if ($('div[class="' + subClass + '"] :visible').find("[data-item-name='spnVetName']")) {
                var param = $('.' + subClass + ' :visible');
                $.each(param.find("[data-item-name='spnVetName']"), function (key, val) {

                    if ($('#' + val.id).text().toLowerCase().match("^" + filtertype)) {
                        $(this).parent().parent().parent().parent().parent().show();
                    }
                    else {
                        $(this).parent().parent().parent().parent().parent().hide();
                    }
                });
            }
            //displayResult();
        } else {

            if ($('div[class="' + subClass + '"] :visible').find("[data-item-name='spnVetLName']")) {
                var param = $('.' + subClass + ' :visible');
                $.each(param.find("[data-item-type='spnVetLName']"), function (key, val) {

                    if ($('#' + val.id).text().toLowerCase().match("^" + filtertype)) {
                        $(this).parent().parent().parent().parent().parent().show();
                    }
                    else {
                        $(this).parent().parent().parent().parent().parent().hide();
                    }
                });              
            }
            
        }
        displayResultSelectPet();
        //displayResult();
    }

    function displayResultSelectPet() {
        debugger;
        $("[data-paging-control='paging_control']").show();
        var itemCount = $('div.listing3').find("#spnVetLName").length;
        var chkcount = 0;
        $.each($('div.listing3'), function (key, val) {
            if ($(this).css('display') == 'none') {
                chkcount = chkcount + 1;
            }
        });
        if (chkcount == itemCount) {
            showPageFilter();
            $('div[data-container="paging_container"]').append("<div class='vetlist'><div class='row'><div id='dvNoRecords'>" + '@Html.Raw(Resources.Pet_Index_FilterNoResult)' + "</div</div</div>");
        $(".vetlist").slideDown(500);
    }
    else {
        $("#dvNoRecords").remove();
        $("[data-paging-control='paging_control']").show('slow');
        showPageFilter();
    }
}

function displayResult() {
    $("[data-paging-control='paging_control']").show();
    var itemCount = $('div.listing3').find("#spnVetName").length;
    var chkcount = 0;
    $.each($('div.listing3'), function (key, val) {
        if ($(this).css('display') == 'none') {
            chkcount = chkcount + 1;
        }
    });
    if (chkcount == itemCount) {
        showPageFilter();
        $('div[data-container="paging_container"]').append("<div class='vetlist'><div class='row'><div id='dvNoRecords'>" + '@Html.Raw(Resources.Pet_Index_FilterNoResult)' + "</div</div</div>");
        $(".vetlist").slideDown(500);
    }
    else {
        $("#dvNoRecords").remove();
        $("[data-paging-control='paging_control']").show('slow');
        showPageFilter();
    }
}
</script>
