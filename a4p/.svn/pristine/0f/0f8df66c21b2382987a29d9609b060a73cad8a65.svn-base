var finalval = 10;

$(document).ready(function () {
    CalculatePrice();
    ChangePlan();

    $("#AdditionalPetRenewal option").filter(function (index) { return $(this).val() === '0'; }).html($('#changeselectText').val()).val(0);
    $("#Promocode").val($("#CurrentPromocode").val());
    $("#AdditionalPetRenewal").change(function () {
        getRenwalPetsPrice();
    });

    $("#Promocode").change(function () {
        ChangePlanListByPromoCode();
    });

    $("#PlanName").change(function () {
        ChangePlan();
    });

    $('#RemovePets').click(function (e) {
        e.preventDefault();
        $.get(this.href, function (data) {
            $('#DeletepetsModel').html(data);
            Initialize();
            $('#DeletepetsModel').modal('show');

        });
    });

    $('#CancelRenewalPlan').click(function () {
        $('#RenewMyPlan').removeClass('tab-pane fade in active').addClass('tab-pane fade');
        $('#UserPlanInfo').removeClass('tab-pane fade').addClass('tab-pane fade in active');

    });

});

var defRewalPrice = 0;
function ChangePlan(isAddPet) {
    var petCount = $('#AdditionalPetRenewal').val();

    var Planid = $('#PlanName :selected').val();
    if (petCount == '') {
        petCount = 0;
        $("#RenuewalPlan").html($("#PlanName option:selected").val());
    }

    $.getJSON(GetApplicationPath() + "Profile/GetPlanPrice", { PlanID: Planid, AdditionalPets: petCount },
        function (data) {
            $("#RenuewalPlan").html(data.finalPlan);
            $("#RenewalPrice").html($("meta[name='accept-currency']").attr("content") + data.price);
            $("#AdditionalInfo").text(data.AdditionalInfo);
            $("#BasePlanDescription").text(data.Description);

            $("#AdditionalPetRenewal").removeAttr('readonly');
            $("#AdditionalPetRenewal").removeAttr('disabled');

            if (data.planvalue == 2) {
                $("#AdditionalPetRenewal").attr('readonly', 'readonly');
                $("#AdditionalPetRenewal").attr('disabled', 'disabled');
            }
            $("#MaxPetCount").val(data.MaxPetCount);
            CalculatePrice(isAddPet);
        });
}

function ChangePlanListByPromoCode() {
    $("#AdditionalPetRenewal").val($("#AdditionalPetRenewal option:first").val());
    var promocode = $('#Promocode').val();
    userId = $("#UserID").val();
    var subItems;
    $.getJSON(GetApplicationPath() + "Users/GetPlansByPromo", { userId: userId, promocode: promocode },
            function (data) {
                $.each(data.Items, function (index, item) {
                    subItems += "<option value='" + item.Value + "'>" + item.Text + "</option>";
                });

                $("#PlanName").html(subItems);
                $("#AdditionalInfo").text(data.AdditionalInfo);
                $("#BasePlanDescription").text(data.Description);
                ChangePlan();
            });
}

function getRenwalPetsPrice() {
    var AdditionalPets = $('#AdditionalPetRenewal :selected').val();
    AdditionalPets = AdditionalPets || 0;
    var selectedItem = parseInt($('#CurrentPlan_NumberofPets').val());
    selectedItem = selectedItem || 0;
    if (AdditionalPets < selectedItem) {
        $("#AdditionalPetRenewal").addClass("input-validation-error");
        $("#AddPetsRenewalErrMsg").css("display", "block");
        ChangePlan();
    } else {
        $("#AddPetsRenewalErrMsg").css("display", "none");
        $("#AdditionalPetRenewal").removeClass("input-validation-error");
        ChangePlan(true);
    }
}

function CalculatePrice(isAddPet) {
    var isPromo = $("#Promocode").val();
    var select1 = $("#MaxPetCount").val();
    var selectmultiple = 1, drpValue = 0;

    if (isAddPet) { } else {
        $('#AdditionalPetRenewal').children('option:not(:first)').remove();
        var addpetDrp = document.getElementById("AdditionalPetRenewal");
        for (i = 0; finalval > drpValue; i++) {
            try {
                var o = document.createElement("option");
                o.value = selectmultiple;
                o.text = select1 * selectmultiple;
                drpValue = select1 * selectmultiple;
                if (!isPromo) {
                    if (select1 >= (select1 * selectmultiple)) {
                        selectmultiple = selectmultiple + 1;
                        addpetDrp.appendChild(o);
                    }
                }
                else {
                    selectmultiple = selectmultiple + 1;
                    addpetDrp.appendChild(o);
                }
            } catch (e) {
                break;
            }
        }
    }
}