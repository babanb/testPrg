@using ADOPets.Web.Common.Extensions
@using ADOPets.Web.Common.Helpers
@using Model
@using Resources = ADOPets.Web.Resources.Wording

@model IEnumerable<ADOPets.Web.ViewModels.Pet.IndexViewModel>

@{
    ViewBag.Title = Resources.Pet_Index_Title;
}
<div class="messageStyle">
    @{ Html.RenderPartial("_Alerts"); }
</div>
<div id="pageTitle">
    <div class="row">
        <div class="col-md-3">
            @if (Roles.IsUserInRole(UserTypeEnum.Admin.ToString()))
            {
                <h1>@Resources.Pet_Index_AdminHeader</h1>
            }
            else
            {
                <h1>@Resources.Pet_Index_Header</h1>
            }
        </div>
        <div class="col-md-3">
            <span class="usericon">
                @Html.EnumDropDownList(typeof(PetTypeEnum), "PetTypeFilter", ViewBag.PetType as PetTypeEnum?, Resources.Pet_Index_AnimalTypeOptionalLabel, new { @class = "form-control" })
            </span>
        </div>
        <div class="col-md-3">
            <span class="usericon">
                @Html.TextBox("PetNameFilter", string.Empty, new { placeholder = Resources.Pet_Index_AnimalNamePlaceHolder, @class = "form-control usericon" })

            </span>
        </div>
        @if (SubscriptionConstraintHelper.CanAddNewPet(ViewBag.OwnerId, ViewBag.TotalPetCount))
        {
            <div class="col-md-3">
                <a href="@Url.Action("Add", "Pet", new { id = @ViewBag.OwnerId })" class="btn btn-success pull-right" id="addPet">
                    <i class="fa fa-plus-circle"></i><span class="hidden-md">@Resources.Pet_Index_AddAnimal</span>
                </a>
            </div>
        }
    </div>
</div>
<div id="mainContainer">
    @if (!Roles.IsUserInRole(UserTypeEnum.VeterinarianAdo.ToString()) && !Roles.IsUserInRole(UserTypeEnum.VeterinarianLight.ToString()) && !Roles.IsUserInRole(UserTypeEnum.VeterinarianExpert.ToString()) && !Roles.IsUserInRole(UserTypeEnum.Admin.ToString()))
    {
        <div id="hiderightsidebar">
            <img src="@Url.Content("~/Content/images/hide-img.png")" width="22" height="34" alt=""/>
        </div>
        <div id="showrightsidebar">
            <img src="@Url.Content("~/Content/images/show-img.png")" width="22" height="34" alt="" />
        </div>
    }
    else
    {
        <div id="buble" class="dynDiv_moveDiv animated zoomInDown">
            <div id="bubleContent">
                @String.Format("{0} - {1}", Resources.Pet_Index_OwnerId, ViewBag.OwnerId)<br>
                @String.Format("{0} - {1}", Resources.Pet_Edit_FirstName, ViewBag.OwnerFirstName)<br>
                @String.Format("{0} - {1}", Resources.Pet_Edit_LastName, ViewBag.OwnerLastName)<br>
                <div id="bubleBottom">
                    <a href="@Url.Action("Index", "Users")">@Resources.Pet_Index_BackToUsers</a> | 
                    <a href="@Url.Action("OwnerProfile", "Profile", new { id = @ViewBag.OwnerId, petId = 0 })" data-toggle="tooltip" data-placement="top" title="@Resources.Profile_OwnerProfile_Title"><i class="fa fa-eye" style="padding-right: 0;"></i></a>| 
                    <a href="javascript:void(0)" id="minimizeBuble"><i class="fa fa-compress" style="padding-right: 0;"></i></a>
                </div>
            </div>
            <a href="javascript:void(0)" id="maximizeBuble"><i class="fa fa-expand" style="padding-right: 0;"></i></a>
        </div>
    }
    <div id="dvHdnTotalRecords" style="display: none;">
        @Model.Count().ToString()
    </div><div id="subCntnt1"></div>
    @if (Model != null && Model.Count() > 0)
    { 
        <div id="listing-main" data-container="paging_container" data-page-size="5">

            @foreach (var item in Model)
            {
                <div class="listing animated fadeInLeft" data-sub-container="sub_container">
                    <div class="row" data-item="item">
                        <div class="col-md-10">
                            @if (string.IsNullOrEmpty(item.PetImage))
                            { 
                                <img src="@Url.Content("~/Content/images/animal-dimg.jpg")" alt="" />
                            }
                            else
                            {
                                <img src="@Url.Action("Image", "Pet", new { fileName = item.PetImage, userInfoPath = item.OwnerInfoPath, ownerId = item.OwnerId })" alt="" />
                            }
                            <p>
                                <strong>@Resources.Pet_Index_AnimalName</strong> : <span id="spnName" data-item-name="pet_name">@Html.DisplayFor(modelItem => item.PetName)</span><br>
                                <strong>@Resources.Pet_Index_AnimalDateOfBirth</strong> : <span id="spnPetBirthDate">@Html.DisplayFor(modelItem => item.PetBirthDate)</span><br>
                                <strong>@Resources.Pet_Index_AnimalSex</strong> : <span id="spnPetGender">@Html.EnumDisplayFor(modelItem => item.PetGender)</span><br>
                                <strong>@Resources.Pet_Index_AnimalType</strong> : <span id="spnPetType" data-item-type="pet_type">@Html.EnumDisplayFor(modelItem => item.PetType)</span>
                                @if (Roles.IsUserInRole(UserTypeEnum.Admin.ToString()))
                                {
                                    <br />
                                    <strong>@Resources.Pet_Index_AdminOwner</strong> <text>:</text> <span id="spnownerName" data-item-name="owner_name">@Html.DisplayFor(modelItem => item.OwnerName)</span>
                                }
                            </p>
                        </div>

                        <div class="col-md-2 listing-control">
                            <a href="@Url.Action("Edit", "Pet", new { id = item.Id })" class="btn btn-primary" data-tooltip="tooltip" data-placement="right" title="@Resources.Pet_Index_View">
                                <i class="fa fa-eye"></i>
                            </a>

                            @if (item.IsActive)
                            {
                                if (SMOHelper.CanDeletePet(item.Id))
                                {
                                <br>
                                <a href="javascript:void(0);" data-href="@Url.Action("DeletePet", "Pet", new { id = item.Id })" data-tooltip="tooltip" data-placement="left" data-toggle="confirmation" class="btn btn-warning" title="@Resources.Users_Index_RemoveUserTooltip">
                                    <i class="fa fa-trash-o"></i>
                                </a>
                                }
                            }
                        </div>
                    </div>
                    <div class="clearfix"></div>
                </div>
            }
        </div>
        <div id="pagingControls" data-paging-control="paging_control"></div>
    }
    else
    {
        <div class="row">
            <h4 style="text-align: center; margin-top: 20px;" class="text-primary">
                @Resources.Pet_Index_NoRecords<br>
            </h4>
        </div>
    }
    <div class="clearfix"></div>
</div>
<!-- welcomeModal -->
<div class="modal fade" id="welcomeModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    @{  var styleData = "";
        if (DomainHelper.GetDomain() == DomainTypeEnum.French || DomainHelper.GetDomain() == DomainTypeEnum.Portuguese)
        {
            styleData = " background: url(../Content/images/welcomeImg-fr.jpg) 15px top no-repeat;text-align: right;min-height: 291px;margin-bottom: 40px;";
        }
        else
        {
            styleData = " background: url(../Content/images/welcomeImg.jpg) 15px top no-repeat;text-align: right;min-height: 291px;margin-bottom: 40px;";
        }
    }

    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">@Resources.Smo_Add_Close</span></button>
            </div>
            <div class="modal-body" style="@styleData">
                <h3 style="line-height: 35px;">@Resources.TakeTour_Welcome_Message1<br>
                    @Resources.TakeTour_Welcome_Message2
                </h3>
                <h1 style="color: #5a9c07;">@Resources.TakeTour_Welcome_GettingStarted</h1>
                <button type="button" id="firstStartTour" class="btn btn-primary btn-lg" data-dismiss="modal">@Resources.TakeTour_Welcome_StartTour</button>
            </div>
        </div>
    </div>

    <style>
        #welcomeModal .modal-header {
            border: none;
        }
        /*#welcomeModal .modal-body {
        styleData;
        }*/

        #welcomeModal .btn-primary {
            border-radius: 3px;
            padding-left: 30px;
            padding-right: 30px;
            margin-top: 25px;
        }

        #welcomeModal h3 {
            font-size: 22px;
            margin-top: 5px;
        }
    </style>
</div>
@if (Roles.IsUserInRole(UserTypeEnum.OwnerAdmin.ToString()))
{
    @Scripts.Render("~/bundles/midJS")
    <script src="@Url.Content("~/Scripts/customs/views/Shared/bootstrap-tour.docs.js")"></script>
}
<script src="@Url.Content("~/Scripts/external/bootstrap-confirmation.js")"></script>
<script src="@Url.Content("~/Scripts/external/pagination.js")"></script>


<script>
    var resourceMessage = '@Html.Raw(Resources.Pet_Index_PagedListPagerPageItemSliceAndTotalFormat)';
    var pager = new Pager();

    $(document).ready(function () {
        initPager(true);
        deleteConfirmation();

        $("#minimizeBuble").click(function (e) {
            $("#maximizeBuble").show();
            $("#minimizeBuble").hide();
            $("#buble").addClass('minimizeBubleStyle');
            $("#bubleContent").hide();
        });
        $("#maximizeBuble").click(function (e) {
            $("#minimizeBuble").show();
            $("#maximizeBuble").hide();
            $("#bubleContent").show();
            $("#buble").removeClass('minimizeBubleStyle');
        });
    });

    function deleteConfirmation() {
        $('[data-toggle="confirmation"]').confirmation({
            title: '@Html.Raw(Resources.Pet_Index_StatusConfirmationTitle)',
            btnOkLabel: '@Html.Raw(Resources.Pet_Index_StatusConfirmationOkLabel)',
            btnCancelLabel: '@Html.Raw(Resources.Pet_Index_StatusConfirmationCancelLabel)'
        });
    }

    function displayResult() {
        $("[data-paging-control='paging_control']").show();
        var itemCount = $('div.listing').find("#spnPetType").length;
        var chkcount = 0;
        $.each($('div.listing'), function (key, val) {
            if ($(this).css('display') == 'none') {
                chkcount = chkcount + 1;
            }
        });
        if (chkcount == itemCount) {
            showPageFilter();
            $('div[data-container="paging_container"]').append("<div class='petlist'><div class='row'><div id='dvNoRecords'>" + '@Html.Raw(Resources.Pet_Index_FilterNoResult)' + "</div</div</div>");
            $(".petlist").slideDown(500);
        }
        else {
            $("#dvNoRecords").remove();
            $("[data-paging-control='paging_control']").show('slow');
            showPageFilter();
        }
    }
</script>
