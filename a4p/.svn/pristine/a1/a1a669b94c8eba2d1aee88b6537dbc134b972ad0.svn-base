@model IEnumerable<ADOPets.Web.ViewModels.Profile.OwnerDetailViewModel>
@using Resources = ADOPets.Web.Resources.Wording


@{
    ViewBag.Title = Resources.Profile_OwnerDetail_Title;
}

@if (Model != null && Model.Count() > 0)
{ 
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">@Resources.CloseButton</span></button>
                <h4 class="modal-title text-primary" id="myModalLabel">@Resources.Profile_OwnerDetail_SelectYourOwner</h4>
            </div>
            <div class="modal-body">
                <div class="well" id="vetsearch">
                    <div class="row">
                        <div class="col-md-3">
                            <h4>@Resources.Profile_OwnerDetail_SearchOwner</h4>
                        </div>
                        <div class="col-md-3">
                            @Html.TextBox("SelectFirstNameFilter", string.Empty, new { placeholder = Resources.Profile_OwnerDetail_SearchByFirstName, @class = "form-control usericon" })
                        </div>
                        <div class="col-md-3">
                            @Html.TextBox("SelectLastNameFilter", string.Empty, new { placeholder = Resources.Profile_OwnerDetail_SearchByLastName, @class = "form-control usericon" })
                        </div>
                        <div class="col-md-3">
                            @Html.TextBox("SelectOwnerIdFilter", string.Empty, new { placeholder = Resources.Profile_OwnerDetail_SearchByOwnerId, @class = "form-control usericon" })
                        </div>
                    </div>
                </div>
                <div class="customscroll"> <div id="subCntnt1"></div>
                    @if (Model != null && Model.Count() > 0)
                    { 
                        <div id="listing-main" data-container="paging_container" data-page-size="5">
                            @foreach (var item in Model)
                            {           
                                <div class="listing2 animated fadeInLeft" data-sub-container="sub_container">
                                    <div class="listing2Icon">
                                        <img src="@Url.Action("GetImageById", "Profile", new { Id = @item.OwnerId })"/>
                                    </div>
                                    <div class="listing2content">
                                        <div class="row" data-item="item">
                                            <div class="col-md-5">
                                                <p>
                                                    <strong>@Resources.Profile_OwnerDetail_FirstName</strong> : <span id="spnFirstName" data-item-name="first_name">@Html.DisplayFor(modelItem => item.FirstName)</span><br>
                                                    <strong>@Resources.Profile_OwnerDetail_LastName</strong> : <span id="spnLastName" data-item-name="last_name">@Html.DisplayFor(modelItem => item.LastName)</span>
                                                </p>
                                            </div>
                                            <div class="col-md-6">
                                                <p>
                                                    <strong>@Resources.Profile_OwnerDetail_OwnerId</strong> : <span id="spnOwner" data-item-name="Owner_Id">@Html.DisplayFor(modelItem => item.OwnerId)</span><br>
                                                    <strong>@Resources.Profile_OwnerDetail_Email</strong> : <span id="spnPetType" data-item-type="pet_type">@Html.DisplayFor(modelItem => item.Email)</span>
                                                </p>
                                            </div>
                                            <div class="col-md-1">
                                                <a href="#" class="btn btn-success btn-sm" onclick="callBtnClick('@(item.OwnerId)')" data-myitemid="@(item.OwnerId)" data-tooltip="tooltip" data-placement="left" title="" data-original-title="Select"><i id="selectPetAnchor" class="fa fa-square-o"></i></a>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="clearfix"></div>
                                </div>
                            }

                        </div>
                        <div id="pagingControls" data-paging-control="paging_control"></div>
                    }
                    else
                    {
                        <div class="row">
                            <h4 style="text-align: center; margin-top: 20px;" class="text-primary">
                                @Resources.Pet_Index_FilterNoResult<br>
                            </h4>
                        </div>
                    }
                </div>
            </div>
            <div class="modal-footer">

                <button type="button" id="ownerclose-bt" class="btn btn-default" data-dismiss="modal">@Resources.Profile_OwnerDetail_Close</button>
                <div class="clearfix"></div>
            </div>

        </div>
    </div>
}

<script src="@Url.Content("~/Scripts/external/bootstrap-confirmation.js")"></script>
<script src="@Url.Content("~/Scripts/external/pagination.js")"></script>

<script>
    var resourceMessage = '@Html.Raw(Resources.Profile_OwnerDetail_PagedListPagerPageItemSliceAndTotalFormat)';
    var pager = new Pager();

    $(document).ready(function () {
        initPager(true);
        deleteConfirmation();
    });

    function deleteConfirmation() {
        $('[data-toggle="confirmation"]').confirmation({
        });
    }


    function displayResult() {

        $("[data-paging-control='paging_control']").show();
        var itemCount = $('div.listing2').find("#spnFirstName").length;
        var chkcount = 0;
        $.each($('div.listing2'), function (key, val) {

            if ($(this).css('display') == 'none') {
                chkcount = chkcount + 1;
            }
        });
        if (chkcount == itemCount) {
            showPageFilter();
            $('div[data-container="paging_container"]').append("<div class='petlist'><div class='row'><div id='dvNoRecords'>" + '@Html.Raw(Resources.Profile_OwnerDetail_FilterNoResult)' + "</div</div</div>");
            $(".petlist").slideDown(500);
        }
        else {
            $("#dvNoRecords").remove();
            $("[data-paging-control='paging_control']").show('slow');
            showPageFilter();
        }
    }


    function callBtnClick(id) {
        var oItemId = id;
        var doctitle = $($(this).children("i[id=selectPetAnchor]"));
        var doc = $('.fa-check-square');
        $.ajax({
            url: '@Url.Action("SelectOwner", "SMO")',
            data: { Id: oItemId },
            type: 'POST',
            dataType: 'json',
            success: function (success) {
                if (success.success == true) {
                    doc.removeClass("fa-check-square").addClass("fa-square-o");
                    doctitle.removeClass("fa-square-o").addClass("fa-check-square");
                    $('#ownerclose-bt').click();
                    $("#selectOwner").text(success.data.Value);
                    localStorage['selectedOwner'] = $('#selectOwner').text();
                    $("#selectOwner").removeAttr('style');
                    $("#spnOwnerRequired").remove();
                }
                else if (success.success == false) {
                    $('#ownerclose-bt').click();
                    $("#selectOwner").html("<i class='fa fa-check-square'></i>Click here");
                    ShowAjaxWarningMessage("A second medical opinion is already in progress for this pet. Please select another pet.");

                }
            },
            error: function (req, status, error) {

            }
        });
    }



    /*****************TODO :: For filter and search of SMOs ********************/


    $("#SelectFirstNameFilter").on('keyup click', function () {
        //debugger
        filtertype = $("#SelectFirstNameFilter").val();
        filtertype1 = $("#SelectLastNameFilter").val();//SelectOwnerIdFilter
        filtertype2 = $("#SelectOwnerIdFilter").val();
        showAll();
        filtertype = filtertype.toLowerCase();
        filtertype1 = filtertype1.toLowerCase();
        filtertype2 = filtertype2.toLowerCase();
        displaySMORecordsStartsWith(filtertype, filtertype1, filtertype2, 'listing2');

    });
    $("#SelectOwnerIdFilter").on('keyup click', function () {
        filtertype = $("#SelectFirstNameFilter").val();
        filtertype1 = $("#SelectLastNameFilter").val();//SelectOwnerIdFilter
        filtertype2 = $("#SelectOwnerIdFilter").val();
        showAll();
        filtertype = filtertype.toLowerCase();
        filtertype1 = filtertype1.toLowerCase();
        filtertype2 = filtertype2.toLowerCase();
        displaySMORecordsStartsWith(filtertype, filtertype1, filtertype2, 'listing2');

    });

    $("#SelectLastNameFilter").on('keyup click', function () {

        filtertype = $("#SelectFirstNameFilter").val();
        filtertype1 = $("#SelectLastNameFilter").val();//SelectOwnerIdFilter
        filtertype2 = $("#SelectOwnerIdFilter").val();
        showAll();
        filtertype = filtertype.toLowerCase();
        filtertype1 = filtertype1.toLowerCase();
        filtertype2 = filtertype2.toLowerCase();
        displaySMORecordsStartsWith(filtertype, filtertype1, filtertype2, 'listing2');

    });

    function displaySMORecordsStartsWith(filtertype, filtertype1, filtertype2, subClass) {

        if ((filtertype != undefined || filtertype != "") && (filtertype1 == undefined || filtertype1 == "") && (filtertype2 == undefined || filtertype2 == "")) {
            if ($('div[class="' + subClass + '"] :visible').find("[data-item-name='first_name']")) {
                var param = $('.' + subClass + ' :visible');

                $.each(param.find("[data-item-name='first_name']"), function (key, val) {


                    if (val.innerHTML.toLowerCase().trim().match("^" + filtertype)) {
                        $(this).parent().parent().parent().parent().parent().show();
                    }
                    else {
                        $(this).parent().parent().parent().parent().parent().hide();
                    }
                });
            }
        }
        else if ((filtertype == undefined || filtertype == "") && (filtertype1 != undefined || filtertype1 != "") && (filtertype2 == undefined || filtertype2 == "")) {
            if ($('div[class="' + subClass + '"] :visible').find("[data-item-name='last_name']")) {
                var param = $('.' + subClass + ' :visible');

                $.each(param.find("[data-item-name='last_name']"), function (key, val) {


                    if (val.innerHTML.toLowerCase().trim().match("^" + filtertype1)) {
                        $(this).parent().parent().parent().parent().parent().show();
                    }
                    else {
                        $(this).parent().parent().parent().parent().parent().hide();
                    }
                });
            }
        }
        else if ((filtertype == undefined || filtertype == "") && (filtertype1 == undefined || filtertype1 == "") && (filtertype2 != undefined || filtertype2 != "")) {
            if ($('div[class="' + subClass + '"] :visible').find("[data-item-name='Owner_Id']")) {
                var param = $('.' + subClass + ' :visible');

                $.each(param.find("[data-item-name='Owner_Id']"), function (key, val) {


                    if (val.innerHTML.toLowerCase().trim().match("^" + filtertype2)) {
                        $(this).parent().parent().parent().parent().parent().show();
                    }
                    else {
                        $(this).parent().parent().parent().parent().parent().hide();
                    }
                });
            }
        }
        else {
            if ($('div[class="' + subClass + '"] :visible').find("[data-item-name='first_name']")) {
                var param = $('.' + subClass + ' :visible');
                $.each(param.find("[data-item-name='first_name']"), function (key, val) {
                    if (val.innerHTML.toLowerCase().trim().match("^" + filtertype)) {

                        $.each($(this).parent().parent().parent().find("[data-item-name='last_name']"), function (key, val) {
                            if (val.innerHTML.toLowerCase().trim().match("^" + filtertype1)) {
                                $.each($(this).parent().parent().parent().find("[data-item-name='Owner_Id']"), function (key, val) {
                                    if (val.innerHTML.toLowerCase().trim().match("^" + filtertype2)) {
                                        $(this).parent().parent().parent().parent().parent().show();
                                    }
                                    else {
                                        $(this).parent().parent().parent().parent().parent().hide();
                                    }
                                });
                            } else {
                                $(this).parent().parent().parent().parent().parent().hide();
                            }
                        });
                    }
                    else {
                        $(this).parent().parent().parent().parent().parent().hide();
                    }
                });
            }
        }

        displayResult();
    }


</script>
